{embed="embeds/.header" loc="home"}

<style>
	{exp:channel:entries channel="home" url_title="home" limit="1" disable="categories|category_fields|member_data|trackbacks|pagination"}
		{home-featured-projects var_prefix="projects-list"}
			{projects-list:project var_prefix="project"}
				{project:projects-main-image}
					{if quality==""}
						.project-img-{projects-list:row_count} {
							background: url({exp:ce_img:single src="{image-file}" width="640" height="360" crop="no" quality="60" url_only="yes" save_type="jpg" bg_color="#fff"}) no-repeat center center;
							filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(
								src='{exp:ce_img:single src="{image-file}" width="640" height="360" crop="yes|{crop-horizontal}, crop="no" quality="60" url_only="yes" save_type="jpg" bg_color="#fff"}',
								sizingMethod='scale');
						}
						@media screen and (min-width: 400px) {
							.project-img-{projects-list:row_count} {
								background: url({exp:ce_img:single src="{image-file}" width="960" height="540" crop="no" quality="60" url_only="yes" save_type="jpg" bg_color="#fff"}) no-repeat center center;
							}
						}
						@media screen and (min-width: 650px) {
							.project-img-{projects-list:row_count} {
								background: url({exp:ce_img:single src="{image-file}" width="1000" height="1000" crop="yes|{crop-horizontal}, {crop-vertical}" quality="60" url_only="yes" save_type="jpg" bg_color="#fff"}) no-repeat {crop-horizontal} {crop-vertical};
							}
						}
						@media screen and (min-width: 800px) {
							.project-img-{projects-list:row_count} {
								background: url({exp:ce_img:single src="{image-file}" width="1500" height="1000" crop="yes|{crop-horizontal}, {crop-vertical}" quality="60" url_only="yes" save_type="jpg" bg_color="#fff"}) no-repeat {crop-horizontal} {crop-vertical};
							}
						}
						@media screen and (min-width: 1200px) {
							.project-img-{projects-list:row_count} {
								background: url({exp:ce_img:single src="{image-file}" width="2000" height="1333" crop="yes|{crop-horizontal}, {crop-vertical}" quality="60" url_only="yes" save_type="jpg" bg_color="#fff"}) no-repeat {crop-horizontal} {crop-vertical};
							}
						}
					{/if}
					{if quality!=""}
						.project-img-{projects-list:row_count} {
							background: url({exp:ce_img:single src="{image-file}" width="640" height="360" crop="no" quality="{quality}" url_only="yes" save_type="jpg" bg_color="#fff"}) no-repeat center center;
							filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(
								src='{exp:ce_img:single src="{image-file}" width="640" height="360" crop="yes|{crop-horizontal}, crop="no" quality="{quality}" url_only="yes" save_type="jpg" bg_color="#fff"}',
								sizingMethod='scale');
						}
						@media screen and (min-width: 400px) {
							.project-img-{projects-list:row_count} {
								background: url({exp:ce_img:single src="{image-file}" width="960" height="540" crop="no" quality="{quality}" url_only="yes" save_type="jpg" bg_color="#fff"}) no-repeat center center;
							}
						}
						@media screen and (min-width: 650px) {
							.project-img-{projects-list:row_count} {
								background: url({exp:ce_img:single src="{image-file}" width="1000" height="1000" crop="yes|{crop-horizontal}, {crop-vertical}" quality="{quality}" url_only="yes" save_type="jpg" bg_color="#fff"}) no-repeat {crop-horizontal} {crop-vertical};
							}
						}
						@media screen and (min-width: 800px) {
							.project-img-{projects-list:row_count} {
								background: url({exp:ce_img:single src="{image-file}" width="1500" height="1000" crop="yes|{crop-horizontal}, {crop-vertical}" quality="{quality}" url_only="yes" save_type="jpg" bg_color="#fff"}) no-repeat {crop-horizontal} {crop-vertical};
							}
						}
						@media screen and (min-width: 1200px) {
							.project-img-{projects-list:row_count} {
								background: url({exp:ce_img:single src="{image-file}" width="2000" height="1333" crop="yes|{crop-horizontal}, {crop-vertical}" quality="{quality}" url_only="yes" save_type="jpg" bg_color="#fff"}) no-repeat {crop-horizontal} {crop-vertical};
							}
						}
					{/if}
				{/project:projects-main-image}
			{/projects-list:project}
		{/home-featured-projects}
	{/exp:channel:entries}
</style>

<div class="section intro">
	<p>After the flood</p>
	<p class="slogan">solves complex design and<br />
		business problems
	</p>
</div>

<!-- TODO:
Need to add a class to the surrounding div that:
- changes the <ul> style to be inline
- adds margins etc.
- possibly also sets sizes for the type

Maybe also add a field to each project page
so that on mobile sizes the category is shown under the image
but above the project's title
and then the leading div is hidden
-->

<div>
	<ul>
		{exp:channel:entries channel="home" limit="3" disable="categories|category_fields|member_data|trackbacks|pagination"}
			{home-featured-projects}
				<li class="projects-project">
					<div class="text">
						<h3 class="category-label">{home-category}</h3>
					</div>
				</li>
			{/home-featured-projects}
		{/exp:channel:entries}
	</ul>
</div>

<!-- TODO:
- Why is this style breaking when it is surrounded by home-featured-projects?
- The hacky category added above the project title should be hidden at sizes above mobile
-->

<div class="home-projects-list">
	<ul>

		{exp:channel:entries channel="home" limit="3"}

			{home-featured-projects var_prefix="projects-list"}
				{projects-list:project var_prefix="project"}

					<li class="projects-project">
						<!-- Note: I've changed the class from
						"projects-project{switch=" i2|"}{switch=" i3||"}{switch=" i4|||"}"
						which was totally screwing up the grid columns, and it seems to work fine.
						However, this switch style doesn't screw anything up on the projects page and I have no idea why.
						That said, on inspection the i2 i3 stuff doesn't look correct or regular on the projects page.
						-->
						<a href="/projects/{project:url_title}" class="title-img-wrap">
							<div class="bw-img">
								<img src="{exp:ce_img:single src="{project:projects-main-image}{image-file}{/projects-main-image}" width="650" height="365" crop="yes" quality="65" url_only="yes"}" alt="{title}" />
							</div>
							<div class="text">
								<p>{home-category}</p>
								<h3>{project:title}</h3>
								<p class="client"><em>for</em> {project:projects-client}</p>
								<p class="summary"><?php echo str_replace('“', '<span class="hanging">“</span>', '{project:projects-summary}'); ?></p>
							</div>
						</a>
					</li>

				{/projects-list:project}
			{/home-featured-projects}

		{/exp:channel:entries}
	</ul>
	<div class="rule rule-1"></div><div class="rule rule-2"></div><div class="rule rule-3"></div>
	<p class="see-more"><a href="/projects">See more</a></p>

</div>

<!--
<div class="featured-projects">
	{exp:channel:entries channel="home" url_title="home" limit="1" disable="categories|category_fields|member_data|trackbacks|pagination"}
		<ul>
		{home-featured-projects var_prefix="projects-list"}
			{projects-list:project var_prefix="project"}
				<li>
					<a href="/projects/{project:url_title}">
						<div class="project-img project-img-{projects-list:row_count}"></div>
						<div class="text">
							<h3><?php echo str_replace('“', '<span class="hanging">“</span>', '{project:projects-summary}'); ?></h3>
							<p class="client">{project:projects-client}</p>
						</div>
					</a>
				</li>
			{/projects-list:project}
		{/home-featured-projects}
		</ul>
	{/exp:channel:entries}
	<p class="see-more"><a href="/projects">See more</a></p>
</div>
-->

<div class="section clients">
	<h2><span>We work across a</span> <span>broad range of sectors</span></h2>
	<ul>
		{exp:channel:entries channel="home" url_title="home" limit="1" disable="categories|category_fields|member_data|trackbacks|pagination"}
			{home-clients limit="12"}
				<li{if url} class="link"{/if}>
					{if url}<a href="{url}">{/if}<img src="<?php echo str_replace("-black", "", "{logo}") ?>" alt="{name}" />{if url}</a>{/if}
				</li>
			{/home-clients}
		{/exp:channel:entries}
	</ul>
</div>

<div class="section journal">
	<h2>From the journal:</h2>
	{exp:channel:entries channel="journal" orderby="date" sort="desc" limit="1" disable="categories|category_fields|member_data|trackbacks|pagination"}
			<h3><a href="/journal">{title}</a></h3>
			<?php
				// find first p that isn't for an image
				$body = '{article-body}';
				preg_match_all("/<p>(.*)<\/p>/", $body, $matches);
				foreach ($matches[0] as $match) {
					if (substr($match, 3, 6) != "image_" && substr($match, 3, 6) != "video_") {
						// if we've found one, output it and move on
						echo str_replace('<p>', '<p class="teaser">', $match);
						break;
					}
				}
			?>
			<p class="date">{entry_date format="%d %F %Y"}</p>
		</a>
	{/exp:channel:entries}
</div>

{embed="embeds/.footer"}
